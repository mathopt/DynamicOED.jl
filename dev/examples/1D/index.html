<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Linear System · DynamicOED.jl</title><meta name="title" content="Linear System · DynamicOED.jl"/><meta property="og:title" content="Linear System · DynamicOED.jl"/><meta property="twitter:title" content="Linear System · DynamicOED.jl"/><meta name="description" content="Documentation for DynamicOED.jl."/><meta property="og:description" content="Documentation for DynamicOED.jl."/><meta property="twitter:description" content="Documentation for DynamicOED.jl."/><script data-outdated-warner src="../../assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.050/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.8/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL="../.."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../../assets/documenter.js"></script><script src="../../search_index.js"></script><script src="../../siteinfo.js"></script><script src="../../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../../assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><div class="docs-package-name"><span class="docs-autofit"><a href="../../">DynamicOED.jl</a></span></div><button class="docs-search-query input is-rounded is-small is-clickable my-2 mx-auto py-1 px-2" id="documenter-search-query">Search docs (Ctrl + /)</button><ul class="docs-menu"><li><a class="tocitem" href="../../">Home</a></li><li><span class="tocitem">Examples</span><ul><li class="is-active"><a class="tocitem" href>Linear System</a></li><li><a class="tocitem" href="../lotka/">Lotka-Volterra</a></li></ul></li><li><a class="tocitem" href="../../theory/">Theory</a></li><li><a class="tocitem" href="../../api/">API</a></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><a class="docs-sidebar-button docs-navbar-link fa-solid fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a><nav class="breadcrumb"><ul class="is-hidden-mobile"><li><a class="is-disabled">Examples</a></li><li class="is-active"><a href>Linear System</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Linear System</a></li></ul></nav><div class="docs-right"><a class="docs-settings-button docs-navbar-link fa-solid fa-gear" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-article-toggle-button fa-solid fa-chevron-up" id="documenter-article-toggle-button" href="javascript:;" title="Collapse all docstrings"></a></div></header><article class="content" id="documenter-page"><h1 id="Design-of-Experiments-for-a-simple-system"><a class="docs-heading-anchor" href="#Design-of-Experiments-for-a-simple-system">Design of Experiments for a simple system</a><a id="Design-of-Experiments-for-a-simple-system-1"></a><a class="docs-heading-anchor-permalink" href="#Design-of-Experiments-for-a-simple-system" title="Permalink"></a></h1><p>As a pedagogical example, lets start with a simple system.</p><p class="math-container">\[\begin{aligned}
\dot{x} &amp;= p_1 x \\ 
y &amp;= x
\end{aligned} \]</p><p>where the state <span>$x$</span> is dependent on a single, uncertain parameter <span>$p_1$</span>. We assume we can observe the state directly with some fixed measurement rate.</p><p>We start by using <a href="https://github.com/SciML/ModelingToolkit.jl">ModelingToolkit.jl</a> and DynamicOED.jl to model the system.</p><pre><code class="language-julia hljs">using DynamicOED
using ModelingToolkit
using Optimization, OptimizationMOI, Ipopt

@variables t x(t) = 1.0 [description = &quot;State&quot;]
@variables y(t) [description=&quot;Observations&quot;, measurement_rate = 0.1]
@parameters p = -2.0 [description= &quot;Uncertain parameter&quot;, tunable = true]

D = Differential(t)

@named simple_system = ODESystem(
    [
        D(x) ~ p*x
    ], tspan = (0., 1.),
    observed = [
        y  ~ x
    ]
)</code></pre><p class="math-container">\[ \begin{align}
\frac{\mathrm{d} x\left( t \right)}{\mathrm{d}t} =&amp; p x\left( t \right)
\end{align}
 \]</p><p>Note that in order to prepare the system for optimal experimental design, we added two important information:</p><ul><li>The parameter <span>$p_1$</span> is marked as <code>tunable</code>. </li><li>The observed variable <span>$y$</span> has a <a href="../../api/#DynamicOED.VariableRate"><code>measurement_rate</code></a>.</li></ul><p>This way, we can limit the set of tunable parameters of the system and derive time grids for the observations independently. To derive the associated system for experimental design, we simply construct an <code>OEDSystem</code>. </p><pre><code class="language-julia hljs">@named oed_system = OEDSystem(simple_system)</code></pre><p class="math-container">\[ \begin{align}
\frac{\mathrm{d} x\left( t \right)}{\mathrm{d}t} =&amp; p x\left( t \right) \\
0 =&amp; x\left( t \right) - \frac{\mathrm{d}}{\mathrm{d}t} G(t)_{1}ˏ_1 + G(t)_{1}ˏ_1 p \\
\frac{\mathrm{d}}{\mathrm{d}t} F(t)_{1}ˏ_1 =&amp; G(t)_{1}ˏ_1^{2} w_1 \\
Q(t)_{1}ˏ_1 =&amp; G(t)_{1}ˏ_1
\end{align}
 \]</p><p>This step augments the initial system with all necessary information, e.g. the sensitivity equations and the dynamics of the fisher information matrix. The output is simply another <code>ODESystem</code>, hence we can use available transformations and simplification routines from ModelingToolkit. </p><p>Next, we associate an optimization criterion to the system and instantiate it over a specific time grid.</p><pre><code class="language-julia hljs">oed_problem = OEDProblem(structural_simplify(oed_system), DCriterion())</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">OEDProblem{ModelingToolkit.ODESystem, DCriterion, DynamicOED.Timegrid{Tuple{Symbol}, Matrix{Int64}, Tuple{Vector{Tuple{Float64, Float64}}}, Vector{Tuple{Float64, Float64}}}, OrdinaryDiffEq.Tsit5{typeof(OrdinaryDiffEq.trivial_limiter!), typeof(OrdinaryDiffEq.trivial_limiter!), Static.False}, NamedTuple{(), Tuple{}}}(ModelingToolkit.ODESystem(0x0000000000000002, Symbolics.Equation[Differential(t)(x(t)) ~ p*x(t), Differential(t)((G(t))[1, 1]) ~ x(t) + (G(t))[1, 1]*p, Differential(t)((F(t))[1, 1]) ~ ((G(t))[1, 1]^2)*w₁], t, Any[x(t), (G(t))[1, 1], (F(t))[1, 1]], SymbolicUtils.BasicSymbolic[p, w₁], (0.0, 1.0), Dict{Any, Any}(:F =&gt; F(t), :p =&gt; p, :G =&gt; G(t), :y =&gt; y(t), :Q =&gt; Q(t), :w₁ =&gt; w₁, :x =&gt; x(t)), Any[], Symbolics.Equation[y(t) ~ x(t), (Q(t))[1, 1] ~ (G(t))[1, 1]], Base.RefValue{Vector{Symbolics.Num}}(Symbolics.Num[]), Base.RefValue{Any}(Matrix{Symbolics.Num}(undef, 0, 0)), Base.RefValue{Any}(Matrix{Symbolics.Num}(undef, 0, 0)), Base.RefValue{Matrix{Symbolics.Num}}(Matrix{Symbolics.Num}(undef, 0, 0)), Base.RefValue{Matrix{Symbolics.Num}}(Matrix{Symbolics.Num}(undef, 0, 0)), :oed_system, ModelingToolkit.ODESystem[], Dict{Any, Any}(p =&gt; -2.0, x(t) =&gt; 1.0, (F(t))[1, 1] =&gt; 0.0, w₁ =&gt; 0.0, (G(t))[1, 1] =&gt; 0.0), nothing, nothing, nothing, ModelingToolkit.SymbolicContinuousCallback[ModelingToolkit.SymbolicContinuousCallback(Symbolics.Equation[], Symbolics.Equation[])], ModelingToolkit.SymbolicDiscreteCallback[], nothing, nothing, TearingState of ModelingToolkit.ODESystem, ModelingToolkit.Substitutions(Symbolics.Equation[(Q(t))[1, 1] ~ (G(t))[1, 1]], [Int64[]], nothing), true, nothing, nothing, nothing, ModelingToolkit.ODESystem(0x0000000000000002, Symbolics.Equation[Differential(t)(x(t)) ~ p*x(t), 0.0 ~ x(t) - Differential(t)((G(t))[1, 1]) + (G(t))[1, 1]*p, Differential(t)((F(t))[1, 1]) ~ ((G(t))[1, 1]^2)*w₁, (Q(t))[1, 1] ~ (G(t))[1, 1]], t, SymbolicUtils.BasicSymbolic{Real}[x(t), (G(t))[1, 1], (F(t))[1, 1], (Q(t))[1, 1]], SymbolicUtils.BasicSymbolic[p, w₁], (0.0, 1.0), Dict{Any, Any}(:F =&gt; F(t), :p =&gt; p, :G =&gt; G(t), :y =&gt; y(t), :Q =&gt; Q(t), :w₁ =&gt; w₁, :x =&gt; x(t)), Any[], Symbolics.Equation[y(t) ~ x(t)], Base.RefValue{Vector{Symbolics.Num}}(Symbolics.Num[]), Base.RefValue{Any}(Matrix{Symbolics.Num}(undef, 0, 0)), Base.RefValue{Any}(Matrix{Symbolics.Num}(undef, 0, 0)), Base.RefValue{Matrix{Symbolics.Num}}(Matrix{Symbolics.Num}(undef, 0, 0)), Base.RefValue{Matrix{Symbolics.Num}}(Matrix{Symbolics.Num}(undef, 0, 0)), :oed_system, ModelingToolkit.ODESystem[], Dict{Any, Any}(p =&gt; -2.0, x(t) =&gt; 1.0, (F(t))[1, 1] =&gt; 0.0, w₁ =&gt; 0.0, (G(t))[1, 1] =&gt; 0.0), nothing, nothing, nothing, ModelingToolkit.SymbolicContinuousCallback[ModelingToolkit.SymbolicContinuousCallback(Symbolics.Equation[], Symbolics.Equation[])], ModelingToolkit.SymbolicDiscreteCallback[], nothing, nothing, nothing, nothing, true, nothing, nothing, nothing, nothing)), DCriterion(), DynamicOED.Timegrid{Tuple{Symbol}, Matrix{Int64}, Tuple{Vector{Tuple{Float64, Float64}}}, Vector{Tuple{Float64, Float64}}}((:w₁,), [1 2 … 9 10], ([(0.0, 0.1), (0.1, 0.2), (0.2, 0.3), (0.3, 0.4), (0.4, 0.5), (0.5, 0.6), (0.6, 0.7), (0.7, 0.8), (0.8, 0.9), (0.9, 1.0)],), [(0.0, 0.1), (0.1, 0.2), (0.2, 0.3), (0.3, 0.4), (0.4, 0.5), (0.5, 0.6), (0.6, 0.7), (0.7, 0.8), (0.8, 0.9), (0.9, 1.0)]), Tsit5(; stage_limiter! = trivial_limiter!, step_limiter! = trivial_limiter!, thread = static(false),), NamedTuple())</code></pre><p>We choose the <a href="../../api/#DynamicOED.DCriterion"><code>DCriterion</code></a>, which minimizes the determinant of the inverse of the Fisher Information. Given that the optimal solution would be to measure all occurrences, we also need to add constraints to the measurement function.</p><pre><code class="language-julia hljs">optimization_variables = states(oed_problem)</code></pre><p class="math-container">\[ \begin{equation}
\left[
\begin{array}{c}
w_{1 1} \\
w_{1 2} \\
w_{1 3} \\
w_{1 4} \\
w_{1 5} \\
w_{1 6} \\
w_{1 7} \\
w_{1 8} \\
w_{1 9} \\
w_{1 1 0} \\
\tau \\
\end{array}
\right]
\end{equation}
 \]</p><div class="admonition is-info"><header class="admonition-header">Note</header><div class="admonition-body"><p>The <code>optimization_states</code> contain several groups of variables, namely <code>measurements</code>, <code>controls</code>, <code>initial_conditions</code>, and <code>regularization</code>. <code>measurements</code> represent the decision to observe at a specific time point at the grid. We currently work with the naming convention <code>w_i</code> for the i-th observed equation.</p></div></div><p>Now we have access to all optimization variables as a <code>ComponentArray</code>. We are interested in choosing at most 3 measurements, so we add a <code>ConstraintSystem</code> from ModelingToolkit.</p><pre><code class="language-julia hljs">constraint_equations = [
    sum(optimization_variables.measurements.w₁) ≲ 3,
]

@named constraint_system = ConstraintsSystem(
    constraint_equations, optimization_variables, []
)</code></pre><p>Finally, we are now able to convert our <a href="../../api/#DynamicOED.OEDProblem"><code>OEDProblem</code></a> into an <code>OptimizationProblem</code> and <code>solve</code> it.</p><div class="admonition is-info"><header class="admonition-header">Note</header><div class="admonition-body"><p>Currently we only support <code>AutoForwardDiff()</code> as an AD backend.</p></div></div><pre><code class="language-julia hljs">optimization_problem = OptimizationProblem(
    oed_problem, AutoForwardDiff(), constraints = constraint_system,
    integer_constraints = false
)

optimal_design = solve(optimization_problem, Ipopt.Optimizer(); hessian_approximation=&quot;limited-memory&quot;)</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">retcode: Success
u: 11-element Vector{Float64}:
 -6.442615705817631e-9
 -4.5193958562343555e-9
  2.9261803704557543e-9
  1.595818811775274e-7
  0.9999999732471323
  0.9999999743442556
  0.9999998731278948
  2.9335593476442558e-8
  5.497538495736485e-9
 -3.6755641831210187e-10
  0.990190480044365</code></pre><p>We see that we have indeed recovered a bang-bang solution to our problem, even though we only solve a relaxed problem. The interested reader can find a more in depth explanation <a href="https://mathopt.de/PUBLICATIONS/Sager2005.pdf">here</a>. </p></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../../">« Home</a><a class="docs-footer-nextpage" href="../lotka/">Lotka-Volterra »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option><option value="auto">Automatic (OS)</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 1.2.0 on <span class="colophon-date" title="Friday 1 December 2023 10:45">Friday 1 December 2023</span>. Using Julia version 1.9.4.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
